<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>ODL(OpenDayLight) 기본 튜토리얼 #7_3 – clustering 설정 | </title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="" />
    
    <meta name="description" content="앞선 예제에서 사용했던 hello 프로젝트를 clustering을 이용하도록 구현해보자. 목표는 global-rpc,routed-rpc 구현과 datastore 공유이다. hello 프로젝트에 아무런 설정을 하지 않고 1ansible-playbook -i hosts playbook_hello.yaml 명령어를 이용하여 3개의 docker instance로">
<meta property="og:type" content="article">
<meta property="og:title" content="ODL(OpenDayLight) 기본 튜토리얼 #7_3 – clustering 설정">
<meta property="og:url" content="https://osujin.github.io/2017/03/17/ODL(OpenDayLight)-기본-튜토리얼-7_3-–-clustering-설정/index.html">
<meta property="og:site_name">
<meta property="og:description" content="앞선 예제에서 사용했던 hello 프로젝트를 clustering을 이용하도록 구현해보자. 목표는 global-rpc,routed-rpc 구현과 datastore 공유이다. hello 프로젝트에 아무런 설정을 하지 않고 1ansible-playbook -i hosts playbook_hello.yaml 명령어를 이용하여 3개의 docker instance로">
<meta property="og:locale" content="ko">
<meta property="og:updated_time" content="2018-04-04T05:47:33.892Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ODL(OpenDayLight) 기본 튜토리얼 #7_3 – clustering 설정">
<meta name="twitter:description" content="앞선 예제에서 사용했던 hello 프로젝트를 clustering을 이용하도록 구현해보자. 목표는 global-rpc,routed-rpc 구현과 datastore 공유이다. hello 프로젝트에 아무런 설정을 하지 않고 1ansible-playbook -i hosts playbook_hello.yaml 명령어를 이용하여 3개의 docker instance로">
    

    

    
        <link rel="icon" href="/image/2018/04/memory_calander_ic.png" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-116900069-1', 'auto');
ga('send', 'pageview');

</script>
    
    


</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">홈</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/IoT/">IoT</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Java/">Java</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/MemoryCalendar/">MemoryCalendar</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/OpenDayLight/">OpenDayLight</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/기타/">기타</a></li></ul>
                                    
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="검색" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '포스트',
            PAGES: 'Pages',
            CATEGORIES: '카테고리',
            TAGS: '태그',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/OpenDayLight/">OpenDayLight</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-ODL(OpenDayLight)-기본-튜토리얼-7_3-–-clustering-설정" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        ODL(OpenDayLight) 기본 튜토리얼 #7_3 – clustering 설정
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2017/03/17/ODL(OpenDayLight)-기본-튜토리얼-7_3-–-clustering-설정/" class="article-date">
            <time datetime="2017-03-17T08:11:02.000Z" itemprop="datePublished">2017-03-17</time>
        </a>
    </div>

                
            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <p>앞선 예제에서 사용했던 hello 프로젝트를 clustering을 이용하도록 구현해보자.</p>
<p>목표는 global-rpc,routed-rpc 구현과 datastore 공유이다.</p>
<p>hello 프로젝트에 아무런 설정을 하지 않고</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -i hosts playbook_hello.yaml</span><br></pre></td></tr></table></figure>
<p>명령어를 이용하여 3개의 docker instance로 배포를한뒤 karaf를 실행시키고 hello-world-write RPC 를 이용하여 datastore에 데이터를 저장하면 3개의 노드 전부 datastore가 복제된다.</p>
<p>DataChangeListener의 경우에는 3개 Node에서 전부 실행 되는게 아니라 특정 Node 한곳에서만 실행이 되는듯 해보이는데 이건 좀더 분석을 해봐야 할것 같다.</p>
<hr>
<p><strong>이제 coretutorials에 있는 singletonsimple 을 직접 hello 프로젝트에 구현을 해보자</strong></p>
<p>일단 기존에 생성된 hello 프로젝트는 ODL lithium 버전으로 만들어져서 이걸 boron 버전으로 변경해줘야 한다. 그런데 lithium 버전은 blueprint를 사용하지 않기 때문에 수동으로 impl 모듈에 blueprint.xml 파일을 넣어주고 기존에 만들어진 module yang 관련 파일은 삭제를 해줘야 한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">impl/src/main 하위에 resources 를 만들고 폴더명이 org/opendaylight/blueprint 인 package 폴더를 만들고 impl-blueprint.xml 파일을 만들어 준다.</span><br><span class="line"></span><br><span class="line">폴더를 생성할때 꼭 확인을 해야 할것이 폴더명이 org.opendaylight.blueprint 으로 되지 않았는지 확인이 필요하다. 폴더구조의 형태로 만들어져야 한다.</span><br></pre></td></tr></table></figure>
<p>impl-blueprint.xml 파일 내용은 아래와 같다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- vi: set et smarttab sw=4 tabstop=4: --&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">Copyright © 2016 Copyright(c) Chun, Inc. and others. All rights reserved.</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">This program and the accompanying materials are made available under the</span></span><br><span class="line"><span class="comment">terms of the Eclipse Public License v1.0 which accompanies this distribution,</span></span><br><span class="line"><span class="comment">and is available at http://www.eclipse.org/legal/epl-v10.html</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">blueprint</span> <span class="attr">xmlns</span>=<span class="string">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:odl</span>=<span class="string">"http://opendaylight.org/xmlns/blueprint/v1.0.0"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">odl:use-default-for-reference-types</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">reference</span> <span class="attr">id</span>=<span class="string">"dataBroker"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">interface</span>=<span class="string">"org.opendaylight.controller.md.sal.binding.api.DataBroker"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">odl:type</span>=<span class="string">"default"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">reference</span> <span class="attr">id</span>=<span class="string">"rpcRegistry"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">interface</span>=<span class="string">"org.opendaylight.controller.sal.binding.api.RpcProviderRegistry"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">reference</span> <span class="attr">id</span>=<span class="string">"notificationService"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">interface</span>=<span class="string">"org.opendaylight.controller.md.sal.binding.api.NotificationPublishService"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">reference</span> <span class="attr">id</span>=<span class="string">"clusterSingletonService"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">interface</span>=<span class="string">"org.opendaylight.mdsal.singleton.common.api.ClusterSingletonServiceProvider"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"provider"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"org.opendaylight.hello.impl.HelloProvider"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">argument</span> <span class="attr">ref</span>=<span class="string">"dataBroker"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">argument</span> <span class="attr">ref</span>=<span class="string">"rpcRegistry"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">argument</span> <span class="attr">ref</span>=<span class="string">"notificationService"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">argument</span> <span class="attr">ref</span>=<span class="string">"clusterSingletonService"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">blueprint</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>impl-blueprint.xml 파일에서 수정해야 할 부분은 bean 설정에서 class 명을 자신이 생성한 provider class와 일치해주면 된다.</p>
<p>blueprint 설정이 끝났으면 기존에 lithium 버전에서 사용했던 파일들을 삭제해줘야 정상적으로 blueprint 사용이 가능하다.</p>
<h4 id="삭제할-파일-및-폴"><a href="#삭제할-파일-및-폴" class="headerlink" title="삭제할 파일 및 폴"></a>삭제할 파일 및 폴</h4><ul>
<li>test 폴더</li>
<li>main/yang 폴더</li>
<li>config 폴더</li>
<li>java/org/opendaylight 하위에 있는 yang 풀더</li>
</ul>
<p>다음으로 각 모듈의 pom 파일을 수정해야 한다.</p>
<ul>
<li>impl 모듈의 pom.xml : version -&gt; <strong>0&#46;5.2-Boron-SR2</strong> 으로 변경</li>
<li>root pom.xml : version -&gt; <strong>1&#46;7.2-Boron-SR2</strong> 으로 변경</li>
<li>api 모듈의 pom.xml : version -&gt; <strong>0&#46;9.2-Boron-SR2</strong> 으로 변경</li>
<li>artifacts 모듈의 pom.xml : version -&gt; <strong>1&#46;8.0-SNAPSHOT</strong> 으로 변경</li>
<li>karaf 모듈의 pom.xml : version -&gt; <strong>1&#46;7.2-Boron-SR2</strong> 으로 변경</li>
<li>feature 모듈의 pom.xml : version -&gt; <strong>1&#46;7.2-Boron-SR2</strong> 으로 변경 , properties tag 안의 내용을 아래와 같이 변경</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mdsal.model.version</span>&gt;</span>0.10.0-SNAPSHOT<span class="tag">&lt;/<span class="name">mdsal.model.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mdsal.version</span>&gt;</span>1.5.0-SNAPSHOT<span class="tag">&lt;/<span class="name">mdsal.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">restconf.version</span>&gt;</span>1.5.0-SNAPSHOT<span class="tag">&lt;/<span class="name">restconf.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">yangtools.version</span>&gt;</span>1.1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">yangtools.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dlux.version</span>&gt;</span>0.5.0-SNAPSHOT<span class="tag">&lt;/<span class="name">dlux.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configfile.directory</span>&gt;</span>etc/opendaylight/karaf<span class="tag">&lt;/<span class="name">configfile.directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>다음엔 HelloProvider.java 파일을 boron 버전에 맞게 수정해줘야 한다.</p>
<p>아래 코드는 소스의 일부분인데 implements 부분이 변경 되었고 생성자로 blueprint 에서 넘겨주는 값을 받도록 설정 하였다.</p>
<p>그리고 ClusterSingletonService 인터페이스의 메소드인 instantiateServiceInstance 메소드에 global rpc 서비스를 등록해주어 singleton cluster 사용을 하도록 수정해준다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloProvider</span> <span class="keyword">implements</span> <span class="title">ClusterSingletonService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(HelloProvider.class);</span><br><span class="line">    <span class="keyword">private</span> DataBroker db;</span><br><span class="line">    <span class="keyword">private</span> RpcRegistration&lt;HelloService&gt; helloService;</span><br><span class="line">    <span class="keyword">private</span> InstanceIdentifier&lt;HelloWorld&gt; path;</span><br><span class="line">    <span class="keyword">private</span> ListenerRegistration&lt;DataChangeListener&gt; data_change_listener;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HostInformation hostInfo = <span class="keyword">new</span> HostInformation();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//boron version</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RpcProviderRegistry rpcProviderRegistry;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NotificationPublishService notificationPublishService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ClusterSingletonServiceProvider clusterSingletonServiceProvider;</span><br><span class="line">    <span class="keyword">private</span> ClusterSingletonServiceRegistration cssRegistration;</span><br><span class="line">    <span class="keyword">private</span> RpcRegistration&lt;GlobalRpcService&gt; globalRpcServiceReg;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ServiceGroupIdentifier IDENT = ServiceGroupIdentifier.create(<span class="string">"Brm"</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloProvider</span><span class="params">(<span class="keyword">final</span> DataBroker dataBroker,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   <span class="keyword">final</span> RpcProviderRegistry rpcProviderRegistry,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   <span class="keyword">final</span> NotificationPublishService notificationPublishService,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   <span class="keyword">final</span> ClusterSingletonServiceProvider clusterSingletonServiceProvider)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.db = dataBroker;</span><br><span class="line">        <span class="keyword">this</span>.rpcProviderRegistry = rpcProviderRegistry;</span><br><span class="line">        <span class="keyword">this</span>.notificationPublishService = notificationPublishService;</span><br><span class="line">        <span class="keyword">this</span>.clusterSingletonServiceProvider = clusterSingletonServiceProvider;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LOG.info(<span class="string">"HelloProvider Session Initiated"</span>);</span><br><span class="line">        HelloWorldImpl helloWorldImpl=<span class="keyword">new</span> HelloWorldImpl();</span><br><span class="line">        <span class="keyword">this</span>.path=helloWorldImpl.HELLO_IID;</span><br><span class="line">        helloWorldImpl.setDb(<span class="keyword">this</span>.db);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//registerDataChangeListener(접근하고자 하는 데이터 트리 종류(config or operational), 데이터 트리 PATH(InstanceIdentifier로 정의),실행될 객체, 변화감지 범위);</span></span><br><span class="line">        <span class="keyword">this</span>.data_change_listener=<span class="keyword">this</span>.db.registerDataChangeListener(LogicalDatastoreType.CONFIGURATION,path,helloWorldImpl,DataChangeScope.SUBTREE);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//boron</span></span><br><span class="line">        cssRegistration = clusterSingletonServiceProvider.registerClusterSingletonService(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.helloService = rpcProviderRegistry.addRpcImplementation(HelloService.class,helloWorldImpl);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        LOG.info(<span class="string">"HelloProvider Closed"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (cssRegistration != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                cssRegistration.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception e) &#123;</span><br><span class="line">                LOG.warn(<span class="string">"Unexpected close exception"</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">            cssRegistration = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (helloService != <span class="keyword">null</span>) &#123;</span><br><span class="line">            helloService.close();</span><br><span class="line">            helloService = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">instantiateServiceInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LOG.info(<span class="string">"We take Leadership"</span>);</span><br><span class="line">        Preconditions.checkState(globalRpcServiceReg == <span class="keyword">null</span>,</span><br><span class="line">                <span class="string">"Unexpected state: we have active GlobalRpcServiceRegistration"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Create a new instance of the Global RPC Service and register it with the RPC registry</span></span><br><span class="line">        globalRpcServiceReg = rpcProviderRegistry.addRpcImplementation(GlobalRpcService.class,</span><br><span class="line">                <span class="keyword">new</span> GlobalRpcServiceImpl(hostInfo));</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListenableFuture&lt;Void&gt; <span class="title">closeServiceInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        LOG.info(<span class="string">"We lost Leadership"</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Unregister the Global RPC instance</span></span><br><span class="line">        <span class="keyword">if</span> (globalRpcServiceReg != <span class="keyword">null</span>) &#123;</span><br><span class="line">            globalRpcServiceReg.close();</span><br><span class="line">            globalRpcServiceReg = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Futures.immediateFuture(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServiceGroupIdentifier <span class="title">getIdentifier</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> IDENT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>global-rpc를 사용하기 위해서는 features.xml 에 odl-mdsal-clustering 를 등록해줘야 한다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">feature</span> <span class="attr">name</span>=<span class="string">'odl-hello'</span> <span class="attr">version</span>=<span class="string">'$&#123;project.version&#125;'</span> <span class="attr">description</span>=<span class="string">'OpenDaylight :: hello'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">feature</span> <span class="attr">version</span>=<span class="string">'$&#123;mdsal.version&#125;'</span>&gt;</span>odl-mdsal-broker<span class="tag">&lt;/<span class="name">feature</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">feature</span> <span class="attr">version</span>=<span class="string">'$&#123;project.version&#125;'</span>&gt;</span>odl-hello-api<span class="tag">&lt;/<span class="name">feature</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">feature</span> <span class="attr">version</span>=<span class="string">'$&#123;mdsal.version&#125;'</span>&gt;</span>odl-mdsal-clustering<span class="tag">&lt;/<span class="name">feature</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bundle</span>&gt;</span>mvn:org.opendaylight.hello/hello-impl/&#123;&#123;VERSION&#125;&#125;<span class="tag">&lt;/<span class="name">bundle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configfile</span> <span class="attr">finalname</span>=<span class="string">"$&#123;configfile.directory&#125;/hello.xml"</span>&gt;</span>mvn:org.opendaylight.hello/hello-impl/&#123;&#123;VERSION&#125;&#125;/xml/config<span class="tag">&lt;/<span class="name">configfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">feature</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>마지막으로 singletonsimple 프로젝트의 yang 파일중에 commons.yang , global-rpc.yang 파일을 hello 프로젝트의 api 폴더에 있는 yang 폴더로 옮겨주고</p>
<p>GlobalRpcServiceImpl.java , HostInformation.java 파일도 impl/src/main/java 하위에 HelloProvider.java 파일이 있는곳에 옮겨주면 singletonsimple 에서 구현된 global-rpc 를 사용 할 수 있다.</p>

        </div>
        <footer class="article-footer">
            



    <a data-url="https://osujin.github.io/2017/03/17/ODL(OpenDayLight)-기본-튜토리얼-7_3-–-clustering-설정/" data-id="cjl62mwff0018k4r60keaw99d" class="article-share-link"><i class="fa fa-share"></i>공유하기</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>


                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>팔로우:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/osujin" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2017/03/18/ODL(OpenDayLight)-기본-튜토리얼-7_4–singletonsimple-RPC-Route-기능-설명/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">새로운</strong>
        <p class="article-nav-title">
        
            ODL(OpenDayLight) 기본 튜토리얼 #7_4 – singletonsimple RPC Route 기능 설명
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2017/03/13/ODL(OpenDayLight)-기본-튜토리얼-7_2-–-ODL-Clustering-소스-배포/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">오래된</strong>
        <p class="article-nav-title">ODL(OpenDayLight) 기본 튜토리얼 #7_2 – ODL Clustering 소스 배포</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">최근 글</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Java/">Java</a></p>
                            <p class="item-title"><a href="/2018/08/23/Spring-boot JPA 이용하기/" class="title">Spring-boot JPA 이용하기</a></p>
                            <p class="item-date"><time datetime="2018-08-23T04:00:32.000Z" itemprop="datePublished">2018-08-23</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Java/">Java</a></p>
                            <p class="item-title"><a href="/2018/08/23/Spring-boot JPA 초기 설정방법 /" class="title">Spring-boot JPA 초기 설정방법</a></p>
                            <p class="item-date"><time datetime="2018-08-23T02:00:32.000Z" itemprop="datePublished">2018-08-23</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/기타/">기타</a></p>
                            <p class="item-title"><a href="/2018/06/21/Linux 서버에서 VPN 자동접속 하는방법/" class="title">Linux 서버에서 VPN 자동접속 하는방법</a></p>
                            <p class="item-date"><time datetime="2018-06-21T05:18:40.000Z" itemprop="datePublished">2018-06-21</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/기타/">기타</a></p>
                            <p class="item-title"><a href="/2018/06/20/kafka-logstash/" class="title">logstash와 kafka 연동시 Multiple Topic 사용하기</a></p>
                            <p class="item-date"><time datetime="2018-06-20T07:52:29.000Z" itemprop="datePublished">2018-06-20</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/MemoryCalendar/">MemoryCalendar</a></p>
                            <p class="item-title"><a href="/2018/04/20/MemoryCalendar-V1/" class="title">MemoryCalendar_V1</a></p>
                            <p class="item-date"><time datetime="2018-04-20T07:05:23.000Z" itemprop="datePublished">2018-04-20</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">카테고리</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IoT/">IoT</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MemoryCalendar/">MemoryCalendar</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OpenDayLight/">OpenDayLight</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/기타/">기타</a><span class="category-list-count">6</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">아카이브</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">8월 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">6월 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">4월 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">1월 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">11월 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">9월 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">8월 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">7월 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">6월 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">5월 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">4월 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">3월 2017</a><span class="archive-list-count">13</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">태그</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ElasticSearch/">ElasticSearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kafka/">kafka</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logstash/">logstash</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">태그 클라우드</h3>
        <div class="widget tagcloud">
            <a href="/tags/ElasticSearch/" style="font-size: 10px;">ElasticSearch</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/logstash/" style="font-size: 10px;">logstash</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">링크</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2018 sujin Oh</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'https://osujin.github.io/2017/03/17/ODL(OpenDayLight)-기본-튜토리얼-7_3-–-clustering-설정/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
